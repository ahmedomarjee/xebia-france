<?xml version="1.0"?>
<!DOCTYPE plugin [
  <!ENTITY process-metrics SYSTEM "/pdk/plugins/process-metrics.xml">
]>
<plugin name="ehcache">
   <classpath>
      <include name="pdk/lib/mx4j" />
   </classpath>

   <server name="EHCache">

      <config>
         <option name="jmx.url" description="JMX URL to MBeanServer" default="service:jmx:rmi:///jndi/rmi://localhost:6970/jmxrmi" />
         <option name="jmx.username" description="JMX username" optional="true" default="system" />
         <option name="jmx.password" description="JMX password" optional="true" default="manager" type="secret" />
      </config>

      <property name="domain" value="net.sf.ehcache" />
      <property name="PROC_HOME_PROPERTY" value="catalina.base" />
      <plugin type="autoinventory" class="org.hyperic.hq.product.jmx.MxServerDetector" />
      <plugin type="measurement" class="org.hyperic.hq.product.jmx.MxMeasurementPlugin" />

      <service name="EHCache Statistics">
         <!-- 
         net.sf.ehcache:type=CacheStatistics,CacheManager=jmxDemoCacheManager,name=fr.xebia.demo.jmx.model.Country
         -->
         <property name="OBJECT_NAME" value="${domain}:type=CacheStatistics,CacheManager=*,name=*" />

         <plugin type="autoinventory" />

         <config>
            <option name="CacheManager" description="Name of the CacheManager" default="" />
            <option name="name" description="Name of Cache" default="" />
         </config>

         <filter name="template" value="${OBJECT_NAME}:${alias}" />

         <metric name="Availability" indicator="true" />
         <metric name="Cache Hits" alias="CacheHits" indicator="true" template="${OBJECT_NAME}:${alias}" units="none" type="trendsup" />
         <metric name="In Memory Hits" alias="InMemoryHits" indicator="true" template="${OBJECT_NAME}:${alias}" units="none" type="trendsup" />
         <metric name="On Disk Hits" alias="OnDiskHits" indicator="true" template="${OBJECT_NAME}:${alias}" units="none" type="trendsup" />
         <metric name="Object Count" alias="ObjectCount" indicator="true" template="${OBJECT_NAME}:${alias}" units="none" />
      </service>

      <service name="Per Application EHCache Statistics">
         <!-- 
         net.sf.ehcache:type=CacheStatistics,CacheManager=jmxDemoCacheManager,name=fr.xebia.demo.jmx.model.Country,path=/jmx-demo
         -->
         <property name="OBJECT_NAME" value="${domain}:type=CacheStatistics,CacheManager=*,name=*,path=*" />

         <plugin type="autoinventory" />

         <config>
            <option name="CacheManager" description="Name of the CacheManager"/>
            <option name="name" description="Name of Cache"/>
            <option name="path" description="Path of the web application" default="/" />
         </config>

         <filter name="template" value="${OBJECT_NAME}:${alias}" />

         <metric name="Availability" indicator="true" />
         <metric name="Cache Hits" alias="CacheHits" indicator="true" template="${OBJECT_NAME}:${alias}" units="none" type="trendsup" />
         <metric name="In Memory Hits" alias="InMemoryHits" indicator="true" template="${OBJECT_NAME}:${alias}" units="none" type="trendsup" />
         <metric name="On Disk Hits" alias="OnDiskHits" indicator="true" template="${OBJECT_NAME}:${alias}" units="none" type="trendsup" />
         <metric name="Object Count" alias="ObjectCount" indicator="true" template="${OBJECT_NAME}:${alias}" units="none" />
      </service>
   </server>
</plugin>