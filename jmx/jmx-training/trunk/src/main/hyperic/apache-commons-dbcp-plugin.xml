<?xml version="1.0"?>
<!DOCTYPE plugin [
  <!ENTITY process-metrics SYSTEM "/pdk/plugins/process-metrics.xml">
]>
<plugin name="apache-commons-dbcp">
   <classpath>
      <include name="pdk/lib/mx4j" />
   </classpath>

   <server name="ApacheCommonsDbcp">

      <config>
         <option name="jmx.url" description="JMX URL to MBeanServer" default="service:jmx:rmi:///jndi/rmi://localhost:6970/jmxrmi" />
         <option name="jmx.username" description="JMX username" optional="true" default="system" />
         <option name="jmx.password" description="JMX password" optional="true" default="manager" type="secret" />
      </config>

      <property name="domain" value="javax.sql" />
      <property name="PROC_HOME_PROPERTY" value="catalina.base" />
      <plugin type="autoinventory" class="org.hyperic.hq.product.jmx.MxServerDetector" />
      <plugin type="measurement" class="org.hyperic.hq.product.jmx.MxMeasurementPlugin" />

      <service name="EHCache Statistics">
         <!-- 
         javax.sql:type=DataSource,name=*
         -->
         <property name="OBJECT_NAME" value="${domain}:type=DataSource,name=*" />

         <plugin type="autoinventory" />

         <config>
            <option name="name" description="Name of the DataSource" default="" />
         </config>

         <filter name="template" value="${OBJECT_NAME}:${alias}" />

         <metric name="Availability" indicator="true" />
         <metric name="Num Active" alias="NumActive" indicator="true" template="${OBJECT_NAME}:${alias}" units="none" />
         <metric name="Num Idle" alias="NumIdle" indicator="true" template="${OBJECT_NAME}:${alias}" units="none" />
      </service>

      <service name="Per Application DataSource statistics">
         <!-- 
         java.util.concurrent:type=ThreadPoolExecutor,name=*,path=*   
         -->
         <property name="OBJECT_NAME" value="${domain}:type=ThreadPoolExecutor,name=*,path=*" />

         <plugin type="autoinventory" />

         <config>
            <option name="name" description="Name of the ExecutorService" default="" />
            <option name="path" description="Path of the web application" default="/" />
         </config>

         <filter name="template" value="${OBJECT_NAME}:${alias}" />

         <metric name="Availability" indicator="true" />
         <metric name="Num Active" alias="NumActive" indicator="true" template="${OBJECT_NAME}:${alias}" units="none" />
         <metric name="Num Idle" alias="NumIdle" indicator="true" template="${OBJECT_NAME}:${alias}" units="none" />
      </service>
   </server>
</plugin>