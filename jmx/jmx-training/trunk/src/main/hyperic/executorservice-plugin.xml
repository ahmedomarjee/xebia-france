<?xml version="1.0"?>
<!DOCTYPE plugin [
  <!ENTITY process-metrics SYSTEM "/pdk/plugins/process-metrics.xml">
]>
<plugin name="executorservice">
   <classpath>
      <include name="pdk/lib/mx4j" />
   </classpath>

   <server name="ExecutorService">

      <config>
         <option name="jmx.url" description="JMX URL to MBeanServer" default="service:jmx:rmi:///jndi/rmi://localhost:6969/jmxrmi" />
         <option name="jmx.username" description="JMX username" optional="true" default="system" />
         <option name="jmx.password" description="JMX password" optional="true" default="manager" type="secret" />
      </config>

      <property name="domain" value="java.util.concurrent" />
      <property name="PROC_HOME_PROPERTY" value="catalina.base" />
      <plugin type="autoinventory" class="org.hyperic.hq.product.jmx.MxServerDetector" />
      <plugin type="measurement" class="org.hyperic.hq.product.jmx.MxMeasurementPlugin" />

      <service name="ExecutorService Statistics">
         <!-- 
         java.util.concurrent:type=ThreadPoolExecutor,name=*       
         -->
         <property name="OBJECT_NAME" value="${domain}:type=ThreadPoolExecutor,name=*" />

         <plugin type="autoinventory" />

         <config>
            <option name="name" description="Name of the ExecutorService" default="" />
         </config>

         <filter name="template" value="${OBJECT_NAME}:${alias}" />

         <metric name="Availability" indicator="true" />
         <metric name="Task Count" alias="TaskCount" indicator="true" template="${OBJECT_NAME}:${alias}" units="none" type="trendsup" />
         <metric name="Rejected Execution Count" alias="RejectedExecutionCount" indicator="true" template="${OBJECT_NAME}:${alias}"
            units="none" type="trendsup" />
         <metric name="Active Count" alias="ActiveCount" indicator="true" template="${OBJECT_NAME}:${alias}" units="none" />
      </service>

      <service name="Per Application ExecutorService Statistics">
         <!-- 
         java.util.concurrent:type=ThreadPoolExecutor,name=*,path=*   
         -->
         <property name="OBJECT_NAME" value="${domain}:type=ThreadPoolExecutor,name=*,path=*" />

         <plugin type="autoinventory" />

         <config>
            <option name="name" description="Name of the ExecutorService" default="" />
            <option name="path" description="Path of the web application" default="/" />
         </config>

         <filter name="template" value="${OBJECT_NAME}:${alias}" />

         <metric name="Availability" indicator="true" />
         <metric name="Task Count" alias="TaskCount" indicator="true" template="${OBJECT_NAME}:${alias}" units="none" type="trendsup" />
         <metric name="Rejected Execution Count" alias="RejectedExecutionCount" indicator="true" template="${OBJECT_NAME}:${alias}"
            units="none" type="trendsup" />
         <metric name="Active Count" alias="ActiveCount" indicator="true" template="${OBJECT_NAME}:${alias}" units="none" />
      </service>
   </server>
</plugin>