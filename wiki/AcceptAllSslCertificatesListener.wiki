#summary Tomcat Listener to accept all HTTPS / X509 certificates with HttpsURLConnection (self-signed, untrusted, expired or with mismatching hostname certificates)

= Configuration =

== Standard Tomcat Configuration ==
*server.xml*
{{{
<Server port="8005" shutdown="SHUTDOWN">
   ...
   <!-- Disable SSL/X509 certificates verifications () -->
  <Listener className="fr.xebia.catalina.listener.AcceptAllSslCertificatesListener"/>

</Server>
}}}


== Parameterized Tomcat Configuration ==

*server.xml*
{{{
<Server port="8005" shutdown="SHUTDOWN">
   ...
   <!-- Disable SSL/X509 certificates verifications () -->
  <Listener 
      enable="${acceptAllSslCertificates}" 
      className="fr.xebia.catalina.listener.AcceptAllSslCertificatesListener"/>

</Server>
}}}

*catalina.properties*
{{{
acceptAllSslCertificates=true
}}}

= Log Messages =

A warning message is emitted in Tomcat logs because disabling SSL verifications is a security hole. 

Then, each time an SSL connection is established with untrusted certificates (self-signed, untrusted Certificate Authority, not yet valid, expired certificates or a mismatch between the URL hostname and the certificate), a warning message is emitted to both reminds user of the security hole and to ease debugging.

*Initialization log message*

{{{
...
Mar 9, 2010 11:08:04 AM fr.xebia.catalina.listener.AcceptAllSslCertificatesListener lifecycleEvent
SEVERE: SSL VERIFICATIONS DISABLED ! SECURITY IS JEOPARDIZED ! SHOULD BE USED CAREFULLY IN PRODUCTION !
...
Mar 9, 2010 11:08:12 AM org.apache.catalina.startup.Catalina start
INFO: Server startup in 8360 ms
}}}

*Log message when an SSL connection is established with an untrusted certificate*

Message for a self-signed expired certificate :

{{{
Mar 9, 2010 11:11:22 AM fr.xebia.catalina.listener.AcceptAllSslCertificatesListener$AcceptAllX509TrustManager checkServerTrusted
SEVERE: SSL SECURITY IS JEOPARDIZED ! Untrusted self-signed expired certificate: 
   'EMAILADDRESS=cleclerc@xebia.fr, CN=localhost, OU=Xebia, O=Xebia, L=Paris, C=FR' (valid from Sun Sep 13 14:47:07 CEST 2009 until Tue Oct 13 14:47:07 CEST 2009) : 
   sun.security.validator.ValidatorException: PKIX path building failed: 
   sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
}}}

*Log message when an SSL connection is established with a mismatch between the URL's hostname and the certificate*

Message for a {{{https://127.0.0.1/...}}} url with {{{localhost}}} declared for the certificate {{{CN}}} :

{{{
Mar 9, 2010 11:11:25 AM fr.xebia.catalina.listener.AcceptAllSslCertificatesListener$AcceptAllHostnameVerifier verify
WARNING: SSL SECURITY IS JEOPARDIZED ! SSL hostname mismatch : given hostname=127.0.0.1, 
   sslSession[peer=127.0.0.1:443, peerPrincipal=[EMAILADDRESS=cleclerc@xebia.fr, CN=localhost, OU=Xebia, O=Xebia, L=Paris, C=FR]]
}}}